---
title: AI image generator
description: "Build a ChatGPT-powered image generator and creators will be able to install it to their whops."
---

## 1. Set up your Next.js project

Clone our Next.js app template:

```bash
npx create-next-app@latest ai-image-generator -e https://github.com/whopio/whop-nextjs-app-template
```

Enter the project directory:

```bash
cd ai-image-generator
```


Install dependencies:
   <CodeGroup>

```bash pnpm
pnpm i
```

```bash npm
npm i
```

```bash yarn
yarn i
```

</CodeGroup>

Run the app locally:
   <CodeGroup>

```bash pnpm
pnpm dev
```

```bash npm
npm run dev
```

```bash yarn
yarn dev
```

</CodeGroup>

Now open http://localhost:3000 and follow the directions on the page.

## 2. Start developing your app
After following the instructions on the page, you'll be able to start developing your app. You should have:
- Created your app
- Set up your `.env.local` file
- Installed your app into your whop

Ensure you're developing in `localhost` mode. See example:
<Frame>
  <img src="/how-to-videos/change-to-localhost-mode.gif" alt="How to change to localhost mode" />
</Frame>


## 3. Set up your database

### Create a Supabase database

Go to [Supabase](https://supabase.com) and create a new account if you don't have one

Create a new project and copy your database password

### Set up Prisma

Now, let's set up Prisma in your project:

<CodeGroup>

```bash pnpm
pnpm add prisma @prisma/client
pnpm prisma init
```

```bash npm
npm install prisma @prisma/client
npx prisma init
```

```bash yarn
yarn add prisma @prisma/client
yarn prisma init
```

</CodeGroup>

The `prisma init` command will create a new `prisma` directory with a `schema.prisma` file

Now, go copy your database connection strings from Supabase for Prisma to use. Then paste the values in your `.env.local` file.

Replace your password with `[YOUR-PASSWORD]`

<Frame>
  <img src="/how-to-videos/prisma-setup.gif" alt="How to setup Prisma with Supabase" />
</Frame>




Replace the contents of `prisma/schema.prisma` with:

```prisma prisma/schema.prisma
// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Experience {
  id           String @unique
  name         String
  prompt       String
  webhookUrl   String
  companyTitle String
  companyId    String
}
```

Now generate your database and Prisma client:

> These are custom scripts we defined in the package.json file to load your env from .env.local and run the prisma commands. If you want to use the native prisma CLI, you'll need to move your `.env.local` to `.env` and run the commands manually.

<CodeGroup>

```bash pnpm
pnpm prisma:generate
pnpm prisma:db:push
```

```bash npm
npm run prisma:generate
npm run prisma:db push
```

```bash yarn
yarn prisma:generate
yarn prisma:db:push
```

</CodeGroup>

Create a database client file at `lib/db.ts`:

```typescript
import { PrismaClient } from "@prisma/client";

const globalForPrisma = globalThis as unknown as {
  prisma: PrismaClient | undefined;
};

export const prisma = globalForPrisma.prisma ?? new PrismaClient();

if (process.env.NODE_ENV !== "production") globalForPrisma.prisma = prisma;
```

This setup will:

1. Create a Prisma client for database operations
2. Use connection pooling for better performance
3. Ensure we don't create multiple instances in development

## 4. Install additional dependencies

### Add the required packages

<CodeGroup>

```bash pnpm
pnpm add openai sharp react-dropzone @radix-ui/react-slot gsap
```

```bash npm
npm install openai sharp react-dropzone @radix-ui/react-slot gsap
```

```bash yarn
yarn add openai sharp react-dropzone @radix-ui/react-slot gsap
```

</CodeGroup>

### Install a Shadcn button

<CodeGroup>
```bash pnpm
pnpm dlx shadcn@latest add button
```

```bash npm
npx shadcn@latest add button
```

```bash yarn
yarn shadcn@latest add button
```

</CodeGroup>

### Add your OpenAI API key
Add to your `.env.local`:

```env .env.local
# OpenAI API Key for image generation
OPENAI_API_KEY=your_openai_api_key_here
```


## 5. Create components

### `<ImageUploader>`
This component handles image upload and generation.

```typescript app/components/image-uploader.tsx
"use client";

import { Button } from "@/components/ui/button";
import gsap from "gsap";
import { DrawSVGPlugin } from "gsap/DrawSVGPlugin";
import Image from "next/image";
import { useCallback, useEffect, useRef, useState } from "react";
import { useDropzone } from "react-dropzone";

gsap.registerPlugin(DrawSVGPlugin);

function Loader() {
Â Â const svgRef = useRef<SVGSVGElement>(null);

Â Â useEffect(() => {
Â Â Â Â if (!svgRef.current) return;

Â Â Â Â const mid = gsap.utils.toArray("#mid *").reverse();

Â Â Â Â const fatTl = gsap.timeline();
Â Â Â Â fatTl.fromTo(
Â Â Â Â Â Â "#fat *",
Â Â Â Â Â Â {
Â Â Â Â Â Â Â Â drawSVG: "0% 20%",
Â Â Â Â Â Â },
Â Â Â Â Â Â {
Â Â Â Â Â Â Â Â drawSVG: "40% 69%",
Â Â Â Â Â Â Â Â stagger: {
Â Â Â Â Â Â Â Â Â Â each: 0.05,
Â Â Â Â Â Â Â Â Â Â repeat: -1,
Â Â Â Â Â Â Â Â Â Â yoyo: true,
Â Â Â Â Â Â Â Â },
Â Â Â Â Â Â Â Â duration: 0.75,
Â Â Â Â Â Â Â Â ease: "sine.inOut",
Â Â Â Â Â Â }
Â Â Â Â );

Â Â Â Â const midTl = gsap.timeline();
Â Â Â Â midTl.fromTo(
Â Â Â Â Â Â mid,
Â Â Â Â Â Â {
Â Â Â Â Â Â Â Â drawSVG: "0% 20%",
Â Â Â Â Â Â },
Â Â Â Â Â Â {
Â Â Â Â Â Â Â Â drawSVG: "56% 86%",
Â Â Â Â Â Â Â Â stagger: {
Â Â Â Â Â Â Â Â Â Â each: 0.08,
Â Â Â Â Â Â Â Â Â Â repeat: -1,
Â Â Â Â Â Â Â Â Â Â yoyo: true,
Â Â Â Â Â Â Â Â },
Â Â Â Â Â Â Â Â duration: 0.81,
Â Â Â Â Â Â Â Â ease: "sine.inOut",
Â Â Â Â Â Â }
Â Â Â Â );

Â Â Â Â const thinTl = gsap.timeline();
Â Â Â Â thinTl.fromTo(
Â Â Â Â Â Â "#thin *",
Â Â Â Â Â Â {
Â Â Â Â Â Â Â Â drawSVG: "20% 51%",
Â Â Â Â Â Â },
Â Â Â Â Â Â {
Â Â Â Â Â Â Â Â drawSVG: "40% 80%",
Â Â Â Â Â Â Â Â stagger: {
Â Â Â Â Â Â Â Â Â Â each: 0.092,
Â Â Â Â Â Â Â Â Â Â repeat: -1,
Â Â Â Â Â Â Â Â Â Â yoyo: true,
Â Â Â Â Â Â Â Â },
Â Â Â Â Â Â Â Â duration: 1.4,
Â Â Â Â Â Â Â Â ease: "sine.inOut",
Â Â Â Â Â Â }
Â Â Â Â );

Â Â Â Â const mainTl = gsap.timeline();
Â Â Â Â mainTl.add([fatTl, midTl, thinTl], 0);

Â Â Â Â return () => {
Â Â Â Â Â Â mainTl.kill();
Â Â Â Â };
Â Â }, []);

Â Â return (
Â Â Â Â <div className="w-full h-full flex items-center justify-center">
Â Â Â Â Â Â <svg
Â Â Â Â Â Â Â Â ref={svgRef}
Â Â Â Â Â Â Â Â id="mainSVG"
Â Â Â Â Â Â Â Â xmlns="http://www.w3.org/2000/svg"
Â Â Â Â Â Â Â Â viewBox="0 0 800 600"
Â Â Â Â Â Â Â Â className="w-100 h-100"
Â Â Â Â Â Â Â Â role="img"
Â Â Â Â Â Â Â Â aria-label="Loading animation"
Â Â Â Â Â Â >
Â Â Â Â Â Â Â Â <title>Loading animation</title>
Â Â Â Â Â Â Â Â <linearGradient
Â Â Â Â Â Â Â Â Â Â id="grad1"
Â Â Â Â Â Â Â Â Â Â x1="393.05"
Â Â Â Â Â Â Â Â Â Â y1="400"
Â Â Â Â Â Â Â Â Â Â x2="393.05"
Â Â Â Â Â Â Â Â Â Â y2="200"
Â Â Â Â Â Â Â Â Â Â gradientUnits="userSpaceOnUse"
Â Â Â Â Â Â Â Â >
Â Â Â Â Â Â Â Â Â Â <stop offset="0" stopColor="#3D28F7" />
Â Â Â Â Â Â Â Â Â Â <stop offset="1" stopColor="#FF3C20" />
Â Â Â Â Â Â Â Â </linearGradient>

Â Â Â Â Â Â Â Â <linearGradient
Â Â Â Â Â Â Â Â Â Â id="grad2"
Â Â Â Â Â Â Â Â Â Â x1="393.05"
Â Â Â Â Â Â Â Â Â Â y1="391.01"
Â Â Â Â Â Â Â Â Â Â x2="393.05"
Â Â Â Â Â Â Â Â Â Â y2="247.71"
Â Â Â Â Â Â Â Â Â Â gradientUnits="userSpaceOnUse"
Â Â Â Â Â Â Â Â >
Â Â Â Â Â Â Â Â Â Â <stop offset="0" stopColor="#F72785" />
Â Â Â Â Â Â Â Â Â Â <stop offset="1" stopColor="#FFEE2A" />
Â Â Â Â Â Â Â Â </linearGradient>

Â Â Â Â Â Â Â Â <linearGradient
Â Â Â Â Â Â Â Â Â Â id="grad3"
Â Â Â Â Â Â Â Â Â Â x1="393.05"
Â Â Â Â Â Â Â Â Â Â y1="400"
Â Â Â Â Â Â Â Â Â Â x2="393.05"
Â Â Â Â Â Â Â Â Â Â y2="200"
Â Â Â Â Â Â Â Â Â Â gradientUnits="userSpaceOnUse"
Â Â Â Â Â Â Â Â >
Â Â Â Â Â Â Â Â Â Â <stop offset="0" stopColor="#FF6820" />
Â Â Â Â Â Â Â Â Â Â <stop offset="1" stopColor="#D1FE21" />
Â Â Â Â Â Â Â Â </linearGradient>

Â Â Â Â Â Â Â Â <linearGradient
Â Â Â Â Â Â Â Â Â Â id="grad4"
Â Â Â Â Â Â Â Â Â Â x1="393.05"
Â Â Â Â Â Â Â Â Â Â y1="400"
Â Â Â Â Â Â Â Â Â Â x2="393.05"
Â Â Â Â Â Â Â Â Â Â y2="250"
Â Â Â Â Â Â Â Â Â Â gradientUnits="userSpaceOnUse"
Â Â Â Â Â Â Â Â >
Â Â Â Â Â Â Â Â Â Â <stop offset="0" stopColor="#35AAF9" />
Â Â Â Â Â Â Â Â Â Â <stop offset="1" stopColor="#993BDC" />
Â Â Â Â Â Â Â Â </linearGradient>

Â Â Â Â Â Â Â Â <g>
Â Â Â Â Â Â Â Â Â Â <g
Â Â Â Â Â Â Â Â Â Â Â Â id="bg"
Â Â Â Â Â Â Â Â Â Â Â Â stroke="url(#grad3)"
Â Â Â Â Â Â Â Â Â Â Â Â fill="none"
Â Â Â Â Â Â Â Â Â Â Â Â strokeLinecap="round"
Â Â Â Â Â Â Â Â Â Â Â Â strokeMiterlimit="10"
Â Â Â Â Â Â Â Â Â Â >
Â Â Â Â Â Â Â Â Â Â Â Â <path d="M594.5,250v-.29L594.6,350" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="580.5" y1="390" x2="580.32" y2="210" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="565.5" y1="415" x2="565.28" y2="185" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="550.5" y1="434" x2="550.24" y2="166" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="535.5" y1="449" x2="535.22" y2="151" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="520.5" y1="462" x2="520.2" y2="138" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="505.5" y1="472" x2="505.18" y2="128" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="490.5" y1="480" x2="490.16" y2="120" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="475.5" y1="487" x2="475.14" y2="113" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="460.5" y1="492" x2="460.14" y2="108" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="445.5" y1="496" x2="445.12" y2="104" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="430.5" y1="499" x2="430.12" y2="101" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="415.5" y1="501" x2="415.12" y2="99" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="400.5" y1="501" x2="400.12" y2="99" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="385.5" y1="501" x2="385.12" y2="99" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="370.5" y1="499" x2="370.12" y2="101" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="355.5" y1="496" x2="355.12" y2="104" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="340.5" y1="492" x2="340.14" y2="108" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="325.5" y1="487" x2="325.14" y2="113" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="310.5" y1="480" x2="310.16" y2="120" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="295.5" y1="472" x2="295.18" y2="128" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="280.5" y1="462" x2="280.2" y2="138" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="265.5" y1="449" x2="265.22" y2="151" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="250.5" y1="434" x2="250.24" y2="166" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="235.5" y1="415" x2="235.28" y2="185" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="220.5" y1="390" x2="220.32" y2="210" />
Â Â Â Â Â Â Â Â Â Â Â Â <polyline points="204.5 250 204.5 350.29 204.5 350" />
Â Â Â Â Â Â Â Â Â Â </g>
Â Â Â Â Â Â Â Â Â Â <g
Â Â Â Â Â Â Â Â Â Â Â Â id="thin"
Â Â Â Â Â Â Â Â Â Â Â Â stroke="url(#grad1)"
Â Â Â Â Â Â Â Â Â Â Â Â fill="none"
Â Â Â Â Â Â Â Â Â Â Â Â strokeLinecap="round"
Â Â Â Â Â Â Â Â Â Â Â Â strokeMiterlimit="10"
Â Â Â Â Â Â Â Â Â Â Â Â strokeWidth="2"
Â Â Â Â Â Â Â Â Â Â >
Â Â Â Â Â Â Â Â Â Â Â Â <path d="M594.6,350l-.1-100.29V250" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="580.5" y1="390" x2="580.32" y2="210" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="565.5" y1="415" x2="565.28" y2="185" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="550.5" y1="434" x2="550.24" y2="166" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="535.5" y1="449" x2="535.22" y2="151" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="520.5" y1="462" x2="520.2" y2="138" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="505.5" y1="472" x2="505.18" y2="128" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="490.5" y1="480" x2="490.16" y2="120" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="475.5" y1="487" x2="475.14" y2="113" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="460.5" y1="492" x2="460.14" y2="108" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="445.5" y1="496" x2="445.12" y2="104" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="430.5" y1="499" x2="430.12" y2="101" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="415.5" y1="501" x2="415.12" y2="99" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="400.5" y1="501" x2="400.12" y2="99" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="385.5" y1="501" x2="385.12" y2="99" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="370.5" y1="499" x2="370.12" y2="101" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="355.5" y1="496" x2="355.12" y2="104" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="340.5" y1="492" x2="340.14" y2="108" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="325.5" y1="487" x2="325.14" y2="113" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="310.5" y1="480" x2="310.16" y2="120" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="295.5" y1="472" x2="295.18" y2="128" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="280.5" y1="462" x2="280.2" y2="138" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="265.5" y1="449" x2="265.22" y2="151" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="250.5" y1="434" x2="250.24" y2="166" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="235.5" y1="415" x2="235.28" y2="185" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="220.5" y1="390" x2="220.32" y2="210" />
Â Â Â Â Â Â Â Â Â Â Â Â <polyline points="204.5 350 204.5 350.29 204.5 250" />
Â Â Â Â Â Â Â Â Â Â </g>
Â Â Â Â Â Â Â Â Â Â <g
Â Â Â Â Â Â Â Â Â Â Â Â id="mid"
Â Â Â Â Â Â Â Â Â Â Â Â stroke="url(#grad2)"
Â Â Â Â Â Â Â Â Â Â Â Â fill="none"
Â Â Â Â Â Â Â Â Â Â Â Â strokeLinecap="round"
Â Â Â Â Â Â Â Â Â Â Â Â strokeMiterlimit="10"
Â Â Â Â Â Â Â Â Â Â Â Â strokeWidth="4"
Â Â Â Â Â Â Â Â Â Â >
Â Â Â Â Â Â Â Â Â Â Â Â <path d="M594.6,350l-.1-100.29V250" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="580.5" y1="390" x2="580.32" y2="210" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="565.5" y1="415" x2="565.28" y2="185" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="550.5" y1="434" x2="550.24" y2="166" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="535.5" y1="449" x2="535.22" y2="151" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="520.5" y1="462" x2="520.2" y2="138" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="505.5" y1="472" x2="505.18" y2="128" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="490.5" y1="480" x2="490.16" y2="120" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="475.5" y1="487" x2="475.14" y2="113" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="460.5" y1="492" x2="460.14" y2="108" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="445.5" y1="496" x2="445.12" y2="104" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="430.5" y1="499" x2="430.12" y2="101" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="415.5" y1="501" x2="415.12" y2="99" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="400.5" y1="501" x2="400.12" y2="99" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="385.5" y1="501" x2="385.12" y2="99" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="370.5" y1="499" x2="370.12" y2="101" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="355.5" y1="496" x2="355.12" y2="104" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="340.5" y1="492" x2="340.14" y2="108" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="325.5" y1="487" x2="325.14" y2="113" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="310.5" y1="480" x2="310.16" y2="120" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="295.5" y1="472" x2="295.18" y2="128" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="280.5" y1="462" x2="280.2" y2="138" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="265.5" y1="449" x2="265.22" y2="151" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="250.5" y1="434" x2="250.24" y2="166" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="235.5" y1="415" x2="235.28" y2="185" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="220.5" y1="390" x2="220.32" y2="210" />
Â Â Â Â Â Â Â Â Â Â Â Â <polyline points="204.5 350 204.5 350.29 204.5 250" />
Â Â Â Â Â Â Â Â Â Â </g>
Â Â Â Â Â Â Â Â Â Â <g
Â Â Â Â Â Â Â Â Â Â Â Â id="fat"
Â Â Â Â Â Â Â Â Â Â Â Â stroke="url(#grad4)"
Â Â Â Â Â Â Â Â Â Â Â Â fill="none"
Â Â Â Â Â Â Â Â Â Â Â Â strokeLinecap="round"
Â Â Â Â Â Â Â Â Â Â Â Â strokeMiterlimit="10"
Â Â Â Â Â Â Â Â Â Â Â Â strokeWidth="7"
Â Â Â Â Â Â Â Â Â Â >
Â Â Â Â Â Â Â Â Â Â Â Â <path d="M594.6,350l-.1-100.29V250" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="580.5" y1="390" x2="580.32" y2="210" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="565.5" y1="415" x2="565.28" y2="185" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="550.5" y1="434" x2="550.24" y2="166" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="535.5" y1="449" x2="535.22" y2="151" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="520.5" y1="462" x2="520.2" y2="138" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="505.5" y1="472" x2="505.18" y2="128" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="490.5" y1="480" x2="490.16" y2="120" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="475.5" y1="487" x2="475.14" y2="113" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="460.5" y1="492" x2="460.14" y2="108" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="445.5" y1="496" x2="445.12" y2="104" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="430.5" y1="499" x2="430.12" y2="101" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="415.5" y1="501" x2="415.12" y2="99" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="400.5" y1="501" x2="400.12" y2="99" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="385.5" y1="501" x2="385.12" y2="99" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="370.5" y1="499" x2="370.12" y2="101" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="355.5" y1="496" x2="355.12" y2="104" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="340.5" y1="492" x2="340.14" y2="108" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="325.5" y1="487" x2="325.14" y2="113" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="310.5" y1="480" x2="310.16" y2="120" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="295.5" y1="472" x2="295.18" y2="128" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="280.5" y1="462" x2="280.2" y2="138" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="265.5" y1="449" x2="265.22" y2="151" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="250.5" y1="434" x2="250.24" y2="166" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="235.5" y1="415" x2="235.28" y2="185" />
Â Â Â Â Â Â Â Â Â Â Â Â <line x1="220.5" y1="390" x2="220.32" y2="210" />
Â Â Â Â Â Â Â Â Â Â Â Â <polyline points="204.5 350 204.5 350.29 204.5 250" />
Â Â Â Â Â Â Â Â Â Â </g>
Â Â Â Â Â Â Â Â </g>
Â Â Â Â Â Â </svg>
Â Â Â Â </div>
Â Â );
}

export default function ImageUploader({
    experienceId,
    prompt,
  }: {
    experienceId: string;
    prompt: string;
  }) {
    const [image, setImage] = useState<string | null>(null);
    const [isGenerating, setIsGenerating] = useState(false);
    const [hasGenerated, setHasGenerated] = useState(false);
    const [uploadProgress, setUploadProgress] = useState(0);

    const onDrop = useCallback((acceptedFiles: File[]) => {
      const file = acceptedFiles[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          setImage(e.target?.result as string);
          setHasGenerated(false);
        };
        reader.readAsDataURL(file);
      }
    }, []);

    const { getRootProps, getInputProps, isDragActive } = useDropzone({
      onDrop,
      accept: {
        "image/*": [".jpeg", ".jpg", ".png", ".gif"],
      },
      maxFiles: 1,
    });

    const handleUpload = async (imageData: string) => {
      try {
        const response = await fetch(
          `/api/experiences/${experienceId}/generate`,
          {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              image: imageData,
              prompt,
            }),
          }
        );

        if (!response.ok) {
          throw new Error("Failed to get upload URL");
        }

        const data = await response.json();
        setImage(data.imageUrl);
        setHasGenerated(true);
      } catch (error) {
        console.error("Error uploading image:", error);
        throw error;
      }
    };

    const handleGenerate = async () => {
      if (!image) return;
      setIsGenerating(true);
      setUploadProgress(0);
      try {
        await handleUpload(image);
      } catch (error) {
        console.error("Error generating image:", error);
      } finally {
        setIsGenerating(false);
      }
    };

    const handleReset = () => {
      setImage(null);
      setHasGenerated(false);
      setUploadProgress(0);
    };

    const handleCopy = async () => {
      if (!image) return;
      try {
        await navigator.clipboard.writeText(image);
      } catch (error) {
        console.error("Failed to copy image URL:", error);
      }
    };

    if (isGenerating) {
      return (
        <div className="w-full max-w-2xl mx-auto p-4 space-y-8">
          <div className="w-full aspect-square flex items-center justify-center">
            <Loader />
          </div>
          <div className="flex gap-4">
            <Button onClick={handleReset} variant="outline" className="flex-1">
              Cancel
            </Button>
            <Button disabled className="flex-1">
              Generating...
            </Button>
          </div>
        </div>
      );
    }

    return (
      <div className="w-full max-w-2xl mx-auto p-4 space-y-8">
        <div
          {...getRootProps()}
          className={`border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors
            ${
              isDragActive
                ? "border-blue-500 bg-blue-50"
                : "border-gray-300 hover:border-blue-400"
            }`}
        >
          <input {...getInputProps()} capture="environment" />
          {image ? (
            <div className="relative w-full aspect-square">
              <Image
                src={image}
                alt="Uploaded image"
                fill
                className="object-contain rounded-lg"
              />
            </div>
          ) : (
            <div className="space-y-4">
              <div className="text-4xl">ğŸ“¸</div>
              <p className="text-gray-600">
                {isDragActive
                  ? "Drop the image here..."
                  : "Drag & drop an image here, or click to select"}
              </p>
              <p className="text-sm text-gray-500">Supports JPG, PNG, GIF</p>
            </div>
          )}
        </div>

        {image && (
          <div className="flex flex-col gap-4">
            {uploadProgress > 0 && uploadProgress < 100 && (
              <div className="w-full bg-gray-200 rounded-full h-2.5">
                <div
                  className="bg-blue-600 h-2.5 rounded-full"
                  style={{ width: `${uploadProgress}%` }}
                />
              </div>
            )}
            <div className="flex gap-4">
              <Button onClick={handleReset} variant="outline" className="flex-1">
                Reset
              </Button>
              <Button
                onClick={hasGenerated ? handleCopy : handleGenerate}
                className="flex-1"
              >
                {hasGenerated ? "Copy Image URL" : "Generate Image"}
              </Button>
            </div>
          </div>
        )}
      </div>
    );
  }

```

### `<ExperiencePrompt>`
This component displays the experience prompt and image uploader.

```typescript app/components/experience-prompt.tsx
import type { AccessLevel } from "@whop/api";
import Link from "next/link";
import ImageUploader from "./image-uploader";
import { Button } from "./ui/button";

export default function ExperiencePrompt({
  prompt,
  accessLevel,
  experienceId,
}: {
  prompt: string;
  accessLevel: AccessLevel;
  experienceId: string;
}) {

  return (
    <div>
      <div className="flex justify-center items-center">
        <div className="text-4xl font-bold text-center">
          {prompt ? `"${prompt}"` : "Creator has not set a prompt yet."}
        </div>
      </div>
      {accessLevel === "admin" && (
        <div className="flex justify-center items-center">
          <Link href={`/experiences/${experienceId}/edit`}>
            <Button variant={"link"}>Edit prompt</Button>
          </Link>
        </div>
      )}
      {prompt ? (
        <ImageUploader prompt={prompt} experienceId={experienceId} />
      ) : null}
    </div>
  );
}
```

### `<EditExperiencePrompt>`
This component allows admins to edit the experience prompt.

```typescript app/components/edit-experience-prompt.tsx
"use client";

import { useState } from "react";
import { useRouter } from "next/navigation";
import { Button } from "@/components/ui/button";

export default function EditExperiencePage({
  experienceId,
}: {
  experienceId: string;
}) {
  const router = useRouter();
  const [prompt, setPrompt] = useState("");
  const [isLoading, setIsLoading] = useState(false);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setIsLoading(true);

    try {
      const response = await fetch(`/api/experiences/${experienceId}`, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({ prompt }),
      });

      if (!response.ok) {
        throw new Error("Failed to update experience");
      }

      router.push(`/experiences/${experienceId}`);
      router.refresh();
    } catch (error) {
      console.error("Error updating experience:", error);
      // You might want to show an error message to the user here
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div className="max-w-2xl mx-auto p-6">
      <h1 className="text-2xl font-bold mb-6">Edit Prompt</h1>

      <form onSubmit={handleSubmit} className="space-y-4">
        <div>
          <label
            htmlFor="prompt"
            className="block text-sm font-medium text-gray-700 mb-2"
          >
            Prompt
          </label>
          <textarea
            id="prompt"
            value={prompt}
            onChange={(e) => setPrompt(e.target.value)}
            className="w-full min-h-[200px] p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="Enter a new prompt here..."
            required
          />
        </div>

        <div className="flex gap-4">
          <Button
            type="submit"
            disabled={isLoading}
            className="bg-blue-500 hover:bg-blue-600 text-white"
          >
            {isLoading ? "Saving..." : "Save Changes"}
          </Button>

          <Button
            type="button"
            variant="outline"
            onClick={() => router.back()}
            disabled={isLoading}
          >
            Cancel
          </Button>
        </div>
      </form>
    </div>
  );
}
```


## 6. Create pages

### `/experiences/[experienceId]/page.tsx`
This page displays the experience prompt and the image uploader. If the user is an admin, they can edit the prompt.

```typescript app/experiences/[experienceId]/page.tsx
import ExperiencePrompt from "@/components/experience-prompt";
import { whopApi } from "@/lib/whop-api";
import { PrismaClient } from "@prisma/client";
import { verifyUserToken } from "@whop/api";
import { headers } from "next/headers";

const prisma = new PrismaClient();

async function findOrCreateExperience(experienceId: string) {
  const result = await whopApi.getExperience({ experienceId });
  const experienceName = result.experience.name;
  const companyTitle = result.experience.company.title;
  const companyId = result.experience.company.id;

  let experience = await prisma.experience.findUnique({
    where: { id: experienceId },
  });
  if (!experience) {
    experience = await prisma.experience.create({
      data: {
        id: experienceId,
        name: experienceName,
        companyTitle,
        companyId,
        prompt: "",
        webhookUrl: "",
      },
    });
  } else {
    experience = await prisma.experience.update({
      where: { id: experienceId },
      data: { name: experienceName, companyTitle, companyId },
    });
  }
  return experience;
}

export default async function ExperiencePage({
  params,
}: {
  params: { experienceId: string };
}) {
  const headersList = await headers();
  const { userId } = await verifyUserToken(headersList);

  const experience = await findOrCreateExperience(params.experienceId);

  const hasAccess = await whopApi.checkIfUserHasAccessToExperience({
    userId,
    experienceId: params.experienceId,
  });

  return (
    <div className="flex flex-col gap-4 p-4 h-screen items-center justify-center">
      <ExperiencePrompt
        prompt={experience.prompt}
        accessLevel={hasAccess.hasAccessToExperience.accessLevel}
        experienceId={params.experienceId}
      />
    </div>
  );
}
```

### `/experiences/[experienceId]/edit/page.tsx`
This page allows admins to edit the experience prompt.

```typescript app/experiences/[experienceId]/edit/page.tsx
import EditExperiencePrompt from "@/components/edit-experience-prompt";

export default async function Page({
  params,
}: {
  params: Promise<{ experienceId: string; accessPassId: string }>;
}) {
  const { experienceId } = await params;
  return <EditExperiencePrompt experienceId={experienceId} />;
}
```


## 7. Create the API routes

### `/api/experiences/[experienceId]/generate/route.ts`
This API route generates images using OpenAI's DALL-E API.

```typescript app/api/experiences/[experienceId]/generate/route.ts
import { verifyUserToken, whopApi } from "@/lib/whop-api";
import { PrismaClient } from "@prisma/client";
import { headers } from "next/headers";
import { NextResponse } from "next/server";
import OpenAI from "openai";
import sharp from "sharp";

const prisma = new PrismaClient();

const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY,
});

export async function POST(request: Request) {
  try {
    // Extract experienceId from the URL
    const url = new URL(request.url);
    const match = url.pathname.match(/experiences\/([^/]+)\/generate/);
    const experienceId = match ? match[1] : null;

    if (!experienceId) {
      return NextResponse.json(
        { error: "Missing experienceId" },
        { status: 400 }
      );
    }

    const headersList = await headers();
    const userToken = await verifyUserToken(headersList);
    if (!userToken) {
      return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
    }

    const hasAccess = await whopApi.checkIfUserHasAccessToExperience({
      userId: userToken.userId,
      experienceId,
    });

    if (!hasAccess.hasAccessToExperience.hasAccess) {
      return NextResponse.json(
        { error: "Unauthorized, no access" },
        { status: 401 }
      );
    }

    const publicUser = await whopApi.getUser({
      userId: userToken.userId,
    });

    const { image } = await request.json();

    const experience = await prisma.experience.findUnique({
      where: {
        id: experienceId,
      },
    });

    if (!image || !experience?.prompt) {
      return NextResponse.json(
        { error: "Image and prompt are required" },
        { status: 400 }
      );
    }

    // Extract image format from base64 string
    const matches = image.match(/^data:image\/([a-zA-Z]+);base64,/);
    if (!matches || !matches[1]) {
      return NextResponse.json(
        { error: "Invalid image format" },
        { status: 400 }
      );
    }
    const imageFormat = matches[1];

    // Convert base64 to buffer
    const base64Data = image.replace(/^data:image\/\w+;base64,/, "");
    const imageBuffer = Buffer.from(base64Data, "base64");

    // Log original image information
    console.log("Original Image Format:", imageFormat);
    console.log("Original Buffer Size:", imageBuffer.length, "bytes");

    // Convert to PNG using sharp
    const pngBuffer = await sharp(imageBuffer).png().toBuffer();

    console.log("PNG Buffer Size:", pngBuffer.length, "bytes");

    // Create a File object from the PNG buffer
    const originalFile = new File([pngBuffer], `${Date.now()}-original.png`, {
      type: "image/png",
    });

    // Log File object information
    console.log("File Size:", originalFile.size, "bytes");
    console.log("File Type:", originalFile.type);
    console.log("File Name:", originalFile.name);

    // Generate image using DALL-E with prompt
    const response = await openai.images.edit({
      model: "gpt-image-1",
      image: originalFile,
      prompt: experience.prompt,
      n: 1,
      size: "1024x1024",
      quality: "high",
    });

    console.log("Response:", response);

    // Get the base64 image data from the response
    const base64Image = response.data?.[0]?.b64_json;
    if (!base64Image) {
      throw new Error("No image data returned from OpenAI");
    }
    const generatedImageBuffer = Buffer.from(base64Image, "base64");

    const originalFileUploadResponse = await whopApi.uploadAttachment({
      file: originalFile,
      record: "forum_post",
    });

    const uploadResponse = await whopApi.uploadAttachment({
      file: new File(
        [generatedImageBuffer],
        `creator-app-generated-${Date.now()}.png`,
        {
          type: "image/png",
        }
      ),
      record: "forum_post",
    });

    const generatedAttachmentId = uploadResponse.directUploadId;
    const originalAttachmentId = originalFileUploadResponse.directUploadId;

    const forum = await whopApi.findOrCreateForum({
      input: { experienceId: experience.id, name: "AI Uploads" },
    });

    const forumId = forum.createForum?.id;

    const post = await whopApi.createForumPost({
      input: {
        forumExperienceId: forumId,
        content: `@${publicUser.publicUser?.username} generated this image with the prompt: "${experience.prompt}"\n\nTry it yourself here: https://whop.com/${experience.companyId}/${experience.id}/app\n\nBefore vs After â¬‡ï¸`,
        attachments: [
          { directUploadId: originalAttachmentId },
          { directUploadId: generatedAttachmentId },
        ],
      },
    });

    // Convert base64 to data URL for the response
    const imageUrl = `data:image/png;base64,${base64Image}`;

    return NextResponse.json({
      success: true,
      imageUrl,
      postId: post.createForumPost?.id,
    });
  } catch (error) {
    console.error("Error generating image:", error);
    return NextResponse.json(
      { error: "Failed to generate image" },
      { status: 500 }
    );
  }
}

```

### `/api/experiences/[experienceId]/route.ts`
This API route is a PUT operation to an experience in the database.

```typescript app/api/experiences/[experienceId]/route.ts
import { verifyUserToken, whopApi } from "@/lib/whop-api";
import { PrismaClient } from "@prisma/client";
import { headers } from "next/headers";
import { NextResponse } from "next/server";

const prisma = new PrismaClient();

export async function PUT(request: Request) {
  try {
    const { prompt } = await request.json();
    const headersList = await headers();
    const userToken = await verifyUserToken(headersList);
    if (!userToken) {
      return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
    }
    const url = new URL(request.url);
    const match = url.pathname.match(/experiences\/([^/]+)/);
    const experienceId = match ? match[1] : null;

    if (!experienceId) {
      return NextResponse.json(
        { error: "Missing experienceId" },
        { status: 400 }
      );
    }

    const hasAccess = await whopApi.checkIfUserHasAccessToExperience({
      userId: userToken.userId,
      experienceId,
    });
    if (hasAccess.hasAccessToExperience.accessLevel !== "admin") {
      return NextResponse.json(
        { error: "Unauthorized, not admin" },
        { status: 401 }
      );
    }

    const updatedExperience = await prisma.experience.update({
      where: {
        id: experienceId,
      },
      data: {
        prompt,
      },
    });

    await whopApi.sendNotification({
      input: {
        content: prompt,
        experienceId,
        title: "Prompt updated âœ¨",
      },
    });

    return NextResponse.json(updatedExperience);
  } catch (error) {
    console.error("Error updating experience:", error);
    return NextResponse.json(
      { error: "Failed to update experience" },
      { status: 500 }
    );
  }
}
```

## 8. Deploy to Vercel

1. Push your code to GitHub
2. Create a new project on [Vercel](https://vercel.com)
3. Import your GitHub repository
4. Add all environment variables
5. Deploy and copy your Vercel URL
6. Update your Whop app settings with the new URL

Your AI image generation app is now ready! Users can upload images, apply AI transformations based on prompts, and share their creations in the community forum.

## Need Help?

- Join the [Developer Whop](https://whop.com/whop-devs)
- View the template for the above [here](https://github.com/whopio/whop-nextjs-app-template)
- Visit our [SDK GitHub repository](https://github.com/whopio/whop-sdk-ts)
